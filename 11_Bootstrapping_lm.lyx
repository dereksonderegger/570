#LyX 2.1 created this file. For more info see http://www.lyx.org/
\lyxformat 474
\begin_document
\begin_header
\textclass book
\begin_preamble
\usepackage{a4wide}
\end_preamble
\options a4paper
\use_default_options false
\begin_modules
knitr
\end_modules
\maintain_unincluded_children false
\language english
\language_package default
\inputencoding iso8859-1
\fontencoding global
\font_roman default
\font_sans default
\font_typewriter default
\font_math auto
\font_default_family default
\use_non_tex_fonts false
\font_sc false
\font_osf false
\font_sf_scale 100
\font_tt_scale 100
\graphics default
\default_output_format default
\output_sync 0
\bibtex_command default
\index_command default
\paperfontsize default
\spacing single
\use_hyperref false
\papersize default
\use_geometry false
\use_package amsmath 1
\use_package amssymb 1
\use_package cancel 1
\use_package esint 0
\use_package mathdots 1
\use_package mathtools 1
\use_package mhchem 0
\use_package stackrel 1
\use_package stmaryrd 1
\use_package undertilde 1
\cite_engine basic
\cite_engine_type default
\biblio_style plain
\use_bibtopic false
\use_indices false
\paperorientation portrait
\suppress_date false
\justification true
\use_refstyle 0
\index Index
\shortcut idx
\color #008000
\end_index
\secnumdepth 3
\tocdepth 3
\paragraph_separation skip
\defskip medskip
\quotes_language english
\papercolumns 1
\papersides 1
\paperpagestyle default
\tracking_changes false
\output_changes false
\html_math_output 0
\html_css_as_file 0
\html_be_strict false
\end_header

\begin_body

\begin_layout Chapter
Bootstrapping Linear Models
\end_layout

\begin_layout Standard
\begin_inset Box Frameless
position "t"
hor_pos "c"
has_inner_box 1
inner_pos "t"
use_parbox 0
use_makebox 0
width "100col%"
special "none"
height "1in"
height_special "totalheight"
status open

\begin_layout Plain Layout
\begin_inset ERT
status open

\begin_layout Plain Layout

<<echo=FALSE>>=
\end_layout

\begin_layout Plain Layout

if(file.exists('Global_Knitr_Opts.R')){
\end_layout

\begin_layout Plain Layout

  source('Global_Knitr_Opts.R')
\end_layout

\begin_layout Plain Layout

}
\end_layout

\begin_layout Plain Layout

opts_chunk$set(fig.path   ='figure/Ch_11_Boot_lm/') 
\end_layout

\begin_layout Plain Layout

opts_chunk$set(cache.path = 'cache/Ch_11_Boot_lm/')
\end_layout

\begin_layout Plain Layout

opts_chunk$set(cache=FALSE)
\end_layout

\begin_layout Plain Layout

@
\end_layout

\end_inset


\end_layout

\end_inset


\begin_inset Newline newline
\end_inset


\begin_inset Box Frameless
position "t"
hor_pos "c"
has_inner_box 1
inner_pos "t"
use_parbox 0
use_makebox 0
width "100col%"
special "none"
height "1in"
height_special "totalheight"
status open

\begin_layout Plain Layout
\begin_inset ERT
status open

\begin_layout Plain Layout

<<message=FALSE, warning=FALSE>>=
\end_layout

\begin_layout Plain Layout

library(mosaic) 
\end_layout

\begin_layout Plain Layout

library(dplyr)
\end_layout

\begin_layout Plain Layout

library(ggplot2)
\end_layout

\begin_layout Plain Layout

library(ggfortify)
\end_layout

\begin_layout Plain Layout

library(car)       # for the Boot function
\end_layout

\begin_layout Plain Layout

library(boot)      # for the boot function
\end_layout

\begin_layout Plain Layout

@
\end_layout

\end_inset


\end_layout

\end_inset


\begin_inset Newline newline
\end_inset

The last several chapters have introduced a number of parametric models
 where we assume that the error terms are normally distributed.
\family typewriter

\begin_inset Formula 
\begin{eqnarray*}
\textrm{One-sample t-test:} & \;\;\;\;\;\; & Y_{i}=\mu+\epsilon_{i}\;\;\;\textrm{where}\;\;\epsilon_{i}\stackrel{iid}{\sim}N\left(0,\sigma\right)\\
\textrm{Two-sample t-test} &  & Y_{ij}=\mu_{i}+\epsilon_{ij}\;\;\;\textrm{where}\;\;\epsilon_{ij}\stackrel{iid}{\sim}N\left(0,\sigma\right)\;\;\;i\in\left\{ 1,2\right\} \\
\textrm{ANOVA} &  & Y_{ij}=\mu_{i}+\epsilon_{ij}\;\;\;\textrm{where}\;\;\epsilon_{ij}\stackrel{iid}{\sim}N\left(0,\sigma\right)\;\;\;i\in\left\{ 1,2,\dots,k\right\} \\
\textrm{Regression} &  & Y_{i}=\beta_{0}+\beta_{1}x_{i}+\epsilon_{i}\;\;\;\textrm{where}\;\;\epsilon_{i}\stackrel{iid}{\sim}N\left(0,\sigma\right)
\end{eqnarray*}

\end_inset


\end_layout

\begin_layout Standard
We developed hypothesis tests and confidence intervals for the model parameters
 assuming that the error terms were normally distributed and, in the event
 that they are normally distributed, those tests and confidence intervals
 are the best we can do.
 However, if the errors are not normally distributed, what should we do?
\end_layout

\begin_layout Standard
Previously we used bootstrapping to estimate the sampling distribution of
 the sampling statistic when we didn't know the distribution.
 We will use the same bootstrapping method, but we'll simplify all of the
 above cases to the the same simple linear model
\begin_inset Formula 
\[
Y_{i}=E\left(Y_{i}\right)+\epsilon_{i}\;\;\;\textrm{where}\;\;\epsilon_{i}\stackrel{iid}{\sim}N\left(0,\sigma\right)
\]

\end_inset

and 
\begin_inset Formula $E\left(Y_{i}\right)$
\end_inset

 takes on some form of the parameters depending on the model specified.
 It turns out that R can do all of these analyses using the same 
\family typewriter
lm()
\family default
 function we used in for regression.
\end_layout

\begin_layout Section
Using 
\family typewriter
lm()
\family default
 for many analyses
\end_layout

\begin_layout Subsection
One-sample t-tests
\end_layout

\begin_layout Standard
In this model we are concerned with testing
\family typewriter

\begin_inset Formula 
\begin{eqnarray*}
H_{0}: &  & \mu=\mu_{0}\\
H_{a}: &  & \mu\ne\mu_{0}
\end{eqnarray*}

\end_inset


\family default
for some 
\begin_inset Formula $\mu_{0}$
\end_inset

.
 For example, suppose we have the following data and we want to test 
\begin_inset Formula $H_{0}:\mu=5$
\end_inset

 vs 
\begin_inset Formula $H_{a}:\mu\ne5$
\end_inset

.
 The R code we used previously was
\begin_inset Newline newline
\end_inset


\begin_inset Box Frameless
position "t"
hor_pos "c"
has_inner_box 1
inner_pos "t"
use_parbox 0
use_makebox 0
width "100col%"
special "none"
height "1in"
height_special "totalheight"
status open

\begin_layout Plain Layout
\begin_inset ERT
status open

\begin_layout Plain Layout

<<message=FALSE>>=
\end_layout

\begin_layout Plain Layout

# How we previously did a t.test
\end_layout

\begin_layout Plain Layout

test.data <- data.frame( y=c(3,5,4,5,7,13) )
\end_layout

\begin_layout Plain Layout

t.test( test.data$y, mu=5 )
\end_layout

\begin_layout Plain Layout

@
\end_layout

\end_inset


\end_layout

\end_inset


\begin_inset Newline newline
\end_inset

but we can just as easily consider this a linear model with only an intercept
 term.
\family typewriter

\begin_inset Newline newline
\end_inset


\family default

\begin_inset Box Frameless
position "t"
hor_pos "c"
has_inner_box 1
inner_pos "t"
use_parbox 0
use_makebox 0
width "100col%"
special "none"
height "1in"
height_special "totalheight"
status open

\begin_layout Plain Layout
\begin_inset ERT
status open

\begin_layout Plain Layout

<<message=FALSE>>=
\end_layout

\begin_layout Plain Layout

m1 <- lm(y ~ 1, data=test.data)
\end_layout

\begin_layout Plain Layout

summary(m1)
\end_layout

\begin_layout Plain Layout

confint(m1)
\end_layout

\begin_layout Plain Layout

@
\end_layout

\end_inset


\end_layout

\end_inset


\begin_inset Newline newline
\end_inset

Notice that we get the same point estimate and confidence interval for 
\begin_inset Formula $\mu$
\end_inset

, but the p-value is different because the 
\family typewriter
t.test()
\family default
 p-value is testing 
\begin_inset Formula $H_{0}:\;\mu=5$
\end_inset

 vs 
\begin_inset Formula $H_{a}:\;\mu\ne5$
\end_inset

 while the 
\family typewriter
lm()
\family default
 function is testing 
\begin_inset Formula $H_{0}:\;\mu=0$
\end_inset

 vs 
\begin_inset Formula $H_{a}:\;\mu\ne0$
\end_inset

.
 
\end_layout

\begin_layout Subsection
Two-sample t-tests
\end_layout

\begin_layout Standard
This model is concerned with testing 
\begin_inset Formula 
\begin{eqnarray*}
H_{0}: &  & \mu_{1}=\mu_{2}\\
H_{a}: &  & \mu_{1}\ne\mu_{2}
\end{eqnarray*}

\end_inset


\begin_inset Newline newline
\end_inset


\begin_inset Box Frameless
position "t"
hor_pos "c"
has_inner_box 1
inner_pos "t"
use_parbox 0
use_makebox 0
width "100col%"
special "none"
height "1in"
height_special "totalheight"
status open

\begin_layout Plain Layout
\begin_inset ERT
status open

\begin_layout Plain Layout

<<message=FALSE>>=
\end_layout

\begin_layout Plain Layout

# How we previously did a t.test
\end_layout

\begin_layout Plain Layout

test.data <- data.frame( y=c(3, 5, 4,  5,  7, 13, 
\end_layout

\begin_layout Plain Layout

                             8, 9, 4, 16, 12, 13 ),
\end_layout

\begin_layout Plain Layout

                         group=rep(c('A','B'), each=6) )
\end_layout

\begin_layout Plain Layout

\end_layout

\begin_layout Plain Layout

t.test( y ~ group, data=test.data, var.equal=TRUE )
\end_layout

\begin_layout Plain Layout

@
\end_layout

\end_inset


\end_layout

\end_inset


\begin_inset Newline newline
\end_inset

This analysis gave use the mean of each group and the confidence interval
 for the difference 
\begin_inset Formula $\mu_{2}-\mu_{1}$
\end_inset

.
 We could get the same analysis an ANOVA with 
\begin_inset Formula $k=2$
\end_inset

 groups.
 
\begin_inset Newline newline
\end_inset


\begin_inset Box Frameless
position "t"
hor_pos "c"
has_inner_box 1
inner_pos "t"
use_parbox 0
use_makebox 0
width "100col%"
special "none"
height "1in"
height_special "totalheight"
status open

\begin_layout Plain Layout
\begin_inset ERT
status open

\begin_layout Plain Layout

<<message=FALSE>>=
\end_layout

\begin_layout Plain Layout

m2 <- lm(y ~ group, data=test.data)
\end_layout

\begin_layout Plain Layout

summary(m2)
\end_layout

\begin_layout Plain Layout

coef(m2)
\end_layout

\begin_layout Plain Layout

confint(m2)
\end_layout

\begin_layout Plain Layout

@
\end_layout

\end_inset


\end_layout

\end_inset


\end_layout

\begin_layout Standard
Aside from 
\family typewriter
t.test()
\family default
 reporting 
\begin_inset Formula $\mu_{2}-\mu_{1}$
\end_inset

 while the 
\family typewriter
lm()
\family default
 function calculates 
\begin_inset Formula $\mu_{1}-\mu_{2}$
\end_inset

, the estimates are identical.
\end_layout

\begin_layout Section
Creating Simulated Data
\end_layout

\begin_layout Standard
The basic goal of statistics is that we are interested in some population
 (which is described by some parameter 
\begin_inset Formula $\mu,\delta,\tau,\beta$
\end_inset

, or generally, 
\begin_inset Formula $\theta$
\end_inset

) and we take a random sample of size 
\begin_inset Formula $n$
\end_inset

 from the population of interest and we 
\emph on
truly believe 
\emph default
that the sample is representative of the population of interest.
 Then we use some statistic of the data 
\begin_inset Formula $\hat{\theta}$
\end_inset

 as an estimate 
\begin_inset Formula $\theta$
\end_inset

.
 However we know that this estimates, 
\begin_inset Formula $\hat{\theta}$
\end_inset

, vary from sample to sample.
 Previously we've used that the Central Limit Theorem gives 
\begin_inset Formula 
\[
\hat{\theta}\stackrel{\cdot}{\sim}N\left(\theta,\,\sigma_{\hat{\theta}}\right)
\]

\end_inset

to construct confidence intervals and perform hypothesis tests, but we don't
 necessarily like this approximation.
 If we could somehow take repeated samples (call these repeated samples
\begin_inset Formula $\mathbb{Y}_{j}$
\end_inset

 for 
\begin_inset Formula $j\in1,2,\dots,M$
\end_inset

) from the population we would understand the distribution of 
\begin_inset Formula $\hat{\theta}$
\end_inset

 by just examining the distribution of many observed values of 
\begin_inset Formula $\hat{\theta}_{j}$
\end_inset

 where 
\begin_inset Formula $\hat{\theta}_{j}$
\end_inset

 is the statistic calculated from the 
\begin_inset Formula $i$
\end_inset

th sample data 
\begin_inset Formula $\mathbb{Y}_{j}$
\end_inset

.
\end_layout

\begin_layout Standard
However, for practical reasons, we can't just take 
\begin_inset Formula $1000$
\end_inset

s of samples of size 
\begin_inset Formula $n$
\end_inset

 from the population.
 However, because we 
\emph on
truly believe
\emph default
 that 
\begin_inset Formula $\mathbb{Y}$
\end_inset

 is representative of the entire population, then our best guess of what
 the population is just many repeated copies of our data.
\end_layout

\begin_layout Standard
\begin_inset Box Frameless
position "t"
hor_pos "c"
has_inner_box 1
inner_pos "t"
use_parbox 0
use_makebox 0
width "100col%"
special "none"
height "1in"
height_special "totalheight"
status open

\begin_layout Plain Layout
\begin_inset ERT
status open

\begin_layout Plain Layout

<<echo=FALSE, message=FALSE>>=
\end_layout

\begin_layout Plain Layout

library(mosaic)
\end_layout

\begin_layout Plain Layout

\end_layout

\begin_layout Plain Layout

# define the multiplot function
\end_layout

\begin_layout Plain Layout

# Multiple plot function 
\end_layout

\begin_layout Plain Layout

# 
\end_layout

\begin_layout Plain Layout

# ggplot objects can be passed in ..., or to plotlist (as a list of ggplot
 objects) 
\end_layout

\begin_layout Plain Layout

# - cols:   Number of columns in layout 
\end_layout

\begin_layout Plain Layout

# - layout: A matrix specifying the layout.
 If present, 'cols' is ignored.
 
\end_layout

\begin_layout Plain Layout

# 
\end_layout

\begin_layout Plain Layout

# If the layout is something like matrix(c(1,2,3,3), nrow=2, byrow=TRUE),
 
\end_layout

\begin_layout Plain Layout

# then plot 1 will go in the upper left, 2 will go in the upper right, and
 
\end_layout

\begin_layout Plain Layout

# 3 will go all the way across the bottom.
 
\end_layout

\begin_layout Plain Layout

#
\end_layout

\begin_layout Plain Layout

multiplot <- function(..., plotlist=NULL, file, cols=1, layout=NULL) {
\end_layout

\begin_layout Plain Layout

  require(grid)
\end_layout

\begin_layout Plain Layout

  # Make a list from the ...
 arguments and plotlist
\end_layout

\begin_layout Plain Layout

  plots <- c(list(...), plotlist)
\end_layout

\begin_layout Plain Layout

  numPlots = length(plots)
\end_layout

\begin_layout Plain Layout

  # If layout is NULL, then use 'cols' to determine layout
\end_layout

\begin_layout Plain Layout

  if (is.null(layout)) {
\end_layout

\begin_layout Plain Layout

    # Make the panel
\end_layout

\begin_layout Plain Layout

    # ncol: Number of columns of plots
\end_layout

\begin_layout Plain Layout

    # nrow: Number of rows needed, calculated from # of cols
\end_layout

\begin_layout Plain Layout

    layout <- matrix(seq(1, cols * ceiling(numPlots/cols)),
\end_layout

\begin_layout Plain Layout

                    ncol = cols, nrow = ceiling(numPlots/cols))
\end_layout

\begin_layout Plain Layout

  }
\end_layout

\begin_layout Plain Layout

\end_layout

\begin_layout Plain Layout

  if (numPlots==1) {
\end_layout

\begin_layout Plain Layout

    print(plots[[1]])
\end_layout

\begin_layout Plain Layout

 } else {
\end_layout

\begin_layout Plain Layout

    # Set up the page
\end_layout

\begin_layout Plain Layout

    grid.newpage()
\end_layout

\begin_layout Plain Layout

    pushViewport(viewport(layout = grid.layout(nrow(layout), ncol(layout))))
\end_layout

\begin_layout Plain Layout

\end_layout

\begin_layout Plain Layout

    # Make each plot, in the correct location
\end_layout

\begin_layout Plain Layout

    for (i in 1:numPlots) {
\end_layout

\begin_layout Plain Layout

      # Get the i,j matrix positions of the regions that contain this subplot
\end_layout

\begin_layout Plain Layout

      matchidx <- as.data.frame(which(layout == i, arr.ind = TRUE))
\end_layout

\begin_layout Plain Layout

      print(plots[[i]], vp = viewport(layout.pos.row = matchidx$row,
\end_layout

\begin_layout Plain Layout

                                      layout.pos.col = matchidx$col))
\end_layout

\begin_layout Plain Layout

    }
\end_layout

\begin_layout Plain Layout

  }
\end_layout

\begin_layout Plain Layout

}
\end_layout

\begin_layout Plain Layout

\end_layout

\begin_layout Plain Layout

# Sample data
\end_layout

\begin_layout Plain Layout

data <- data.frame(
\end_layout

\begin_layout Plain Layout

  x=rep(1:3, times=3), y=rep(1:3, each=3),
\end_layout

\begin_layout Plain Layout

  shape=c('Sq','Sq','Di', 'Cir','Sq','Cir', 'Tri','Cir','Sq') )
\end_layout

\begin_layout Plain Layout

\end_layout

\begin_layout Plain Layout

data2 <- rbind(
\end_layout

\begin_layout Plain Layout

       mutate(data, x=x+0, y=y+0),
\end_layout

\begin_layout Plain Layout

       mutate(data, x=x+0, y=y+3),
\end_layout

\begin_layout Plain Layout

       mutate(data, x=x+0, y=y+6),
\end_layout

\begin_layout Plain Layout

       mutate(data, x=x+3, y=y+0),
\end_layout

\begin_layout Plain Layout

       mutate(data, x=x+3, y=y+3),
\end_layout

\begin_layout Plain Layout

       mutate(data, x=x+3, y=y+6),
\end_layout

\begin_layout Plain Layout

       mutate(data, x=x+6, y=y+0),
\end_layout

\begin_layout Plain Layout

       mutate(data, x=x+6, y=y+3),
\end_layout

\begin_layout Plain Layout

       mutate(data, x=x+6, y=y+6))
\end_layout

\begin_layout Plain Layout

\end_layout

\begin_layout Plain Layout

library(ggdendro)
\end_layout

\begin_layout Plain Layout

sample.plot <- ggplot(data=data) +
\end_layout

\begin_layout Plain Layout

  geom_point(aes(x=x, y=y, shape=shape), size=20, fill='dark grey') +
\end_layout

\begin_layout Plain Layout

  scale_shape_manual(values=c(21,23,22,24), guide=FALSE) +
\end_layout

\begin_layout Plain Layout

  coord_cartesian(xlim = c(0.5, 3.5), c(0.5,3.5)) +
\end_layout

\begin_layout Plain Layout

  theme_dendro() + ggtitle('Sample')
\end_layout

\begin_layout Plain Layout

\end_layout

\begin_layout Plain Layout

population.plot <- ggplot(data=data2) +
\end_layout

\begin_layout Plain Layout

  geom_point(aes(x=x, y=y, shape=shape), size=8, fill='dark grey') +
\end_layout

\begin_layout Plain Layout

  scale_shape_manual(values=c(21,23,22,24), guide=FALSE) +
\end_layout

\begin_layout Plain Layout

  coord_cartesian(xlim = c(0.5, 10), c(0.5,10)) +
\end_layout

\begin_layout Plain Layout

  theme_dendro() + ggtitle('Approximate Population')
\end_layout

\begin_layout Plain Layout

\end_layout

\begin_layout Plain Layout

@
\end_layout

\end_inset


\end_layout

\end_inset


\end_layout

\begin_layout Standard
Suppose we were to sample from a population of shapes, and we observed 
\begin_inset Formula $4/9$
\end_inset

 of the sample were squares, 
\begin_inset Formula $3/9$
\end_inset

 were circles, and a triangle and a diamond.
 Then our best guess of what the population that we sampled from was a populatio
n with 
\begin_inset Formula $4/9$
\end_inset

 squares, 
\begin_inset Formula $3/9$
\end_inset

 circles, and 
\begin_inset Formula $1/9$
\end_inset

 of triangles and diamonds.
 
\begin_inset Newline newline
\end_inset


\begin_inset Float figure
wide false
sideways false
status open

\begin_layout Plain Layout
\begin_inset Box Frameless
position "t"
hor_pos "c"
has_inner_box 1
inner_pos "t"
use_parbox 0
use_makebox 0
width "100col%"
special "none"
height "1in"
height_special "totalheight"
status open

\begin_layout Plain Layout
\begin_inset ERT
status open

\begin_layout Plain Layout

<<echo=FALSE, fig.width=7, fig.height=4, message=FALSE>>=
\end_layout

\begin_layout Plain Layout

multiplot(sample.plot, population.plot, cols=2)
\end_layout

\begin_layout Plain Layout

@
\end_layout

\end_inset


\end_layout

\end_inset


\end_layout

\begin_layout Plain Layout
\begin_inset Caption Standard

\begin_layout Plain Layout
A possible sample from a population of shapes.
 Because 
\begin_inset Formula $4/9$
\end_inset

 of our sample were squares, our best estimate is that the population is
 also approximately 
\begin_inset Formula $4/9$
\end_inset

 squares.
 We can think of the approximated population as just many many copies of
 the observed sample data.
\end_layout

\end_inset


\end_layout

\end_inset


\end_layout

\begin_layout Standard
Using this approximated population (which is just many many copies of our
 sample data), we can take many samples of size 
\begin_inset Formula $n$
\end_inset

.
 We denote these bootstrap samples as 
\begin_inset Formula $\mathbb{Y}_{j}^{*}$
\end_inset

, where the star denotes that the sample was taken from the approximate
 population, not the actual population.
 From each bootstrap sample 
\begin_inset Formula $\mathbb{Y}_{j}^{*}$
\end_inset

 a statistic of interest can be taken 
\begin_inset Formula $\hat{\theta}_{j}^{*}$
\end_inset

.
\end_layout

\begin_layout Standard
Because our approximate population is just an infinite number of copies
 of our sample data, then sampling from the approximate population is equivalent
 to sampling 
\emph on
with replacement
\emph default
 from our sample data.
 If I take 
\begin_inset Formula $n$
\end_inset

 samples from 
\begin_inset Formula $n$
\end_inset

 distinct objects with replacement, then the process can be thought of as
 mixing the 
\begin_inset Formula $n$
\end_inset

 objects in a bowl and taking an object at random, noting which it is, replace
 it into the bowl, and then draw the next sample.
 Practically, this means some objects will be selected more than once and
 some will not be chosen at all.
 To sample our observed data with replacement, we'll use the 
\family typewriter
resample()
\family default
 function in the 
\family typewriter
mosaic
\family default
 package.
 We see that some rows will be selected multiple times, and some will not
 be selected at all.
\begin_inset Newline newline
\end_inset


\end_layout

\begin_layout Subsection
Observational Studies vs Designed Experiments
\end_layout

\begin_layout Standard
The process of collecting data is a time consuming and laborious process
 but is critical to our understanding of the world.
 The fundamental goal is to collect a sample of dat that is representative
 of the population of interest and can provide insight into the scientific
 question at hand.
 There are two primary classes about how this data could be gathered, observatio
nal studies and designed experiments.
 
\end_layout

\begin_layout Standard
In an observational study, a population is identified and a random sample
 of individuals are selected to be in the sample.
 Then each subject in the sample has explanatory and response variables
 measured (fish are weighed and length recorded, people asked their age,
 gender, occupation etc).
 The critical part of this data collection method is that the random selection
 from the population is done in a fashion so that each individual in the
 population could potentially be in the sample and there is no systematic
 exclusion of certain parts of the population.
 
\end_layout

\begin_layout Standard

\series bold
Simple Random Samples 
\series default
-
\series bold
 
\series default
Suppose that we could generate a list of every individual in the population
 and then we were to randomly select 
\begin_inset Formula $n$
\end_inset

 of those to be our sample.
 Then each individual would have an equal chance to be in the sample and
 this selection scheme should result in sample data that is representative
 of the population of interest.
 Often though, it is difficult to generate a list of every individual, but
 other proxies might work.
 For example if we wanted to understand cougar behavior in the Grand Canyon,
 we might divide the park up into 100 regions and then random select 20
 of those regions to sample and observe whatever cougar(s) are in that region.
 
\end_layout

\begin_layout Standard

\series bold
Stratified Random Samples -
\series default
 In a stratified random sample, the population can be broken up into different
 strata and we perform a simple random sample within each strata.
 For example when sampling lake fish, we might think about the lake having
 deep and shallow/shore water strata and perhaps our sampling technique
 is different for those two strata (electro-fishing on shore and trawling
 in the deep sections).
 For human populations, we might stratify on age and geographic location
 (older retired people will answer the phone more readily than younger people).
 For each of the strata, we often have population level information about
 the different strata (proportion of the lake that is deep water versus
 shallow, or proportion of the population 20-29, 30-39, etc.
 and sample each strata accordingly (e.g.
 if shallow water is 40% of the fish habitat, then 40% of our sampling effort
 is spent in the shallows).
\end_layout

\begin_layout Standard
Regardless of sample type, the key idea behind an observational study is
 that we don't apply a treatment to the subject and then observe a response.
 While we might annoy animal or person, we don't do any long-term manipulations.
 Instead the individuals are randomly selected and then observed, and it
 is the random selection from the population that results in a sample that
 is representative of the population.
\end_layout

\begin_layout Standard

\series bold
Designed Experiments - 
\series default
In an experimental setting, the subjects are taken from the population (usually
 not at random but rather by convenience) and then subjected to some treatments
 and we observe the individuals response to the treatment.
 There will usually be several levels of the treatment and there often is
 a control level.
 For example, we might want to understand how to maximize the growth of
 a type of fungus for a pharmaceutical application and we consider applying
 different nutrients to the substrate (nothing, +phosphorus, +nitrogen,
 +both).
 Another example is researchers looking at the efficacy of smoking cessation
 methods and taking a set of willing subjects and having them try different
 methods (no help, nicotine patches, nicotine patches and a support group).
 There might be other covariates that we expect might affect the success
 rate (individuals age, length of time smoking, gender) and we might make
 sure that our study include people in each of these groups (we call these
 blocks in the experimental design terminology, but they are equivalent
 to the strata in the observational study terminology).
 Because even within blocks, we expect variability in the success rates
 due to natural variation, we randomize the treatment assignment to the
 individual and it is this randomization that addresses any unrecognized
 lurking variables that also affect the response.
\end_layout

\begin_layout Standard
A designed experiment is vastly superior to an observational experiment
 because the randomization of the treatment accounts for variables that
 the researcher might not even suspect to be important.
 A nice example of the difference between observational studies and experiments
 is a set of studies done relating breast cancer and hormone replacement
 therapy (HRT) drugs used by post-menopausal women.
 Initial observational studies that looked at the rates of breast cancer
 showed that women taking HRT had 
\emph on
lower
\emph default
 rates of breast cancer.
 When these results were first published, physicians happily recommended
 HRT to manage menopause symptoms and to decrease risk of breast cancer.
 Unfortunately subsequent observational studies showed a weaker effect and
 among some populations there was an increase in breast cancer.
 To answer the question clearly, a massive designed experiment was undertaken
 where women would be 
\emph on
randomly
\emph default
 assigned either a placebo or the actual HRT drugs.
 This study conclusively showed that HRT drugs increased the risk of breast
 cancer.
\end_layout

\begin_layout Standard
Why was there a disconnect between the original observational studies and
 the experiment? The explanation given is that there was a lurking variable
 that the observational studies did not control for...
 socio-economic class.
 There are many drivers of breast cancer and some of them are strongly correlate
d with socio-economic class such as where you live (in a polluted area or
 not).
 Furthermore because HRT was initially only to relieve symptoms of menopause,
 it wasn't 
\begin_inset Quotes eld
\end_inset

medically necessary
\begin_inset Quotes erd
\end_inset

 and insurance didn't cover it and so mainly wealthy women (with already
 lower risk for breast cancer) took the HRT drugs and the simple association
 between lower breast cancer risk and HRT was actually the effect of socio-econo
mic status.
 By randomly assigning women to the placebo and HRT groups, high socio-economic
 women ended up in both groups.
 So even if there was some other lurking variable that the researchers didn't
 consider, the randomization would cause the unknown variable to be evenly
 distributed in the placebo and HRT groups.
 
\end_layout

\begin_layout Standard
Because the method of randomization is so different between observational
 studies and designed experiments, we should make certain that our method
 of creating bootstrap data sets respects that difference in randomization.
 So if there was some constraint on the data when it was originally taken,
 we want the bootstrap datasets to obey that same constraint.
 If our study protocol was to collect a sample of 
\begin_inset Formula $n_{1}=10$
\end_inset

 men and 
\begin_inset Formula $n_{2}=10$
\end_inset

 women, then we want our bootstrap samples to have 10 men and 10 women.
 If we designed an experiment with 25 subjects to test the efficacy of a
 drug and chose to administer doses of 5, 10, 20, 40, and 80 mg with each
 five subjects for each dose level, then we want those same dose levels
 to show up in the bootstrap datasets.
 
\end_layout

\begin_layout Standard
There are two common approaches, case resampling and residual resampling.
 In case resampling, we consider the data 
\begin_inset Formula $\left(x_{i,}y_{i}\right)$
\end_inset

 pairs as one unit and when creating a bootstrap sample, we resample those
 pairs, but if the 
\begin_inset Formula $i$
\end_inset

th data point is included in the bootstrap sample, then it is included as
 the 
\begin_inset Formula $\left(x_{i,}y_{i}\right)$
\end_inset

 pair.
 In contrast, residual resampling is done by first fitting a model to the
 data, finding the residual values, resampling those residuals and then
 adding those bootstrap residuals to the predicted values 
\begin_inset Formula $\hat{y}_{i}$
\end_inset

.
\end_layout

\begin_layout Standard
\begin_inset Box Frameless
position "t"
hor_pos "c"
has_inner_box 1
inner_pos "t"
use_parbox 0
use_makebox 0
width "100col%"
special "none"
height "1in"
height_special "totalheight"
status open

\begin_layout Plain Layout
\begin_inset ERT
status open

\begin_layout Plain Layout

<<echo=FALSE>>=
\end_layout

\begin_layout Plain Layout

set.seed(3)
\end_layout

\begin_layout Plain Layout

@
\end_layout

\end_inset


\end_layout

\end_inset


\begin_inset Box Frameless
position "t"
hor_pos "c"
has_inner_box 1
inner_pos "t"
use_parbox 0
use_makebox 0
width "100col%"
special "none"
height "1in"
height_special "totalheight"
status open

\begin_layout Plain Layout
\begin_inset ERT
status open

\begin_layout Plain Layout

<<message=FALSE>>=
\end_layout

\begin_layout Plain Layout

library(dplyr)
\end_layout

\begin_layout Plain Layout

library(mosaic)
\end_layout

\begin_layout Plain Layout

Testing.Data <- data.frame(
\end_layout

\begin_layout Plain Layout

  x = c(3,5,7,9),
\end_layout

\begin_layout Plain Layout

  y = c(3,7,7,11))
\end_layout

\begin_layout Plain Layout

Testing.Data
\end_layout

\begin_layout Plain Layout

@
\end_layout

\end_inset


\end_layout

\end_inset


\end_layout

\begin_layout Standard
\begin_inset Box Frameless
position "t"
hor_pos "c"
has_inner_box 1
inner_pos "t"
use_parbox 0
use_makebox 0
width "100col%"
special "none"
height "1in"
height_special "totalheight"
status open

\begin_layout Plain Layout
\begin_inset ERT
status open

\begin_layout Plain Layout

<<>>=
\end_layout

\begin_layout Plain Layout

# Case resampling 
\end_layout

\begin_layout Plain Layout

Boot.Data <- resample(Testing.Data)
\end_layout

\begin_layout Plain Layout

Boot.Data
\end_layout

\begin_layout Plain Layout

@
\end_layout

\end_inset


\end_layout

\end_inset


\end_layout

\begin_layout Standard
Notice that we've sampled 
\begin_inset Formula $\left\{ x=5,y=7\right\} $
\end_inset

 twice and did not get the 
\begin_inset Formula $\left\{ 7,7\right\} $
\end_inset

 data point.
 
\end_layout

\begin_layout Standard
Residual sampling is done by resampling the residuals and calling them 
\begin_inset Formula $\hat{\epsilon}^{*}$
\end_inset

 and then the new y-values will be 
\begin_inset Formula 
\[
y_{i}^{*}=\hat{y}_{i}+\hat{\epsilon}_{i}^{*}
\]

\end_inset


\end_layout

\begin_layout Standard
\begin_inset Box Frameless
position "t"
hor_pos "c"
has_inner_box 1
inner_pos "t"
use_parbox 0
use_makebox 0
width "100col%"
special "none"
height "1in"
height_special "totalheight"
status open

\begin_layout Plain Layout
\begin_inset ERT
status open

\begin_layout Plain Layout

<<>>=
\end_layout

\begin_layout Plain Layout

# Residual resampling
\end_layout

\begin_layout Plain Layout

model <- lm( y ~ x, data=Testing.Data)
\end_layout

\begin_layout Plain Layout

Boot.Data <- Testing.Data %>%
\end_layout

\begin_layout Plain Layout

  mutate( fit = fitted(model),
\end_layout

\begin_layout Plain Layout

          resid = resid(model),
\end_layout

\begin_layout Plain Layout

          resid.star = resample(resid),
\end_layout

\begin_layout Plain Layout

          y.star = fit + resid.star )
\end_layout

\begin_layout Plain Layout

Boot.Data
\end_layout

\begin_layout Plain Layout

@
\end_layout

\end_inset


\end_layout

\end_inset


\begin_inset Newline newline
\end_inset

Notice that the residuals resampling results in a data set where each of
 the x-values is retained, but a new y-value (possibly not seen in the original
 data) is created from the predicted value 
\begin_inset Formula $\hat{y}$
\end_inset

 and a randomly selected residual.
\end_layout

\begin_layout Standard
In general when we design an experiment, we choose which x-values we want
 to look at and so the bootstrap data should have those same x-values we
 chose.
 So for a designed experiment, we typically will create bootstrap data sets
 via residual resampling.
 For observational studies, we'll create the bootstrap data sets via case
 resampling.
 In both cases if there is a blocking or strata variable to consider, we
 will want to do the resampling 
\emph on
within
\emph default
 the block/strata.
\end_layout

\begin_layout Section
Confidence Interval Types 
\end_layout

\begin_layout Standard
We want to understand the relationship between the sample statistic 
\begin_inset Formula $\hat{\theta}$
\end_inset

 to the population parameter 
\begin_inset Formula $\theta$
\end_inset

.
 We create an estimated population using many repeated copies of our data.
 By examining how the simulated 
\begin_inset Formula $\hat{\theta}^{*}$
\end_inset

 vary relative to 
\begin_inset Formula $\hat{\theta}$
\end_inset

, we will understand how possible 
\begin_inset Formula $\hat{\theta}$
\end_inset

 values vary relative to 
\begin_inset Formula $\theta$
\end_inset

.
 
\end_layout

\begin_layout Standard
\begin_inset Box Frameless
position "t"
hor_pos "c"
has_inner_box 1
inner_pos "t"
use_parbox 0
use_makebox 0
width "100col%"
special "none"
height "1in"
height_special "totalheight"
status open

\begin_layout Plain Layout
\begin_inset ERT
status open

\begin_layout Plain Layout

<<echo=FALSE>>=
\end_layout

\begin_layout Plain Layout

library(dplyr) 
\end_layout

\begin_layout Plain Layout

library(ggplot2)
\end_layout

\begin_layout Plain Layout

M <- 1001 
\end_layout

\begin_layout Plain Layout

theta <- seq(-10,60, length=M)
\end_layout

\begin_layout Plain Layout

\end_layout

\begin_layout Plain Layout

temp <- data.frame(
\end_layout

\begin_layout Plain Layout

  theta = theta,
\end_layout

\begin_layout Plain Layout

  y     = dgamma(theta, 10, 1/2))
\end_layout

\begin_layout Plain Layout

temp <- filter(temp, (theta >= 0)&(theta <= 60))
\end_layout

\begin_layout Plain Layout

p1 <- ggplot(temp, aes(x=theta, y=y)) +
\end_layout

\begin_layout Plain Layout

  geom_line() +
\end_layout

\begin_layout Plain Layout

  geom_vline(xintercept=20, color='red') +
\end_layout

\begin_layout Plain Layout

  geom_text(data=data.frame(x=22, y=.01, label='theta'),
\end_layout

\begin_layout Plain Layout

            aes(x=x, y=y, label=label),
\end_layout

\begin_layout Plain Layout

            parse=TRUE, color='red') +
\end_layout

\begin_layout Plain Layout

  labs(title=expression(paste('Sampling Distribution of ',hat(theta))),
\end_layout

\begin_layout Plain Layout

       x=NULL, y='density') +
\end_layout

\begin_layout Plain Layout

  theme_bw()
\end_layout

\begin_layout Plain Layout

\end_layout

\begin_layout Plain Layout

temp <- data.frame(
\end_layout

\begin_layout Plain Layout

  theta = theta,
\end_layout

\begin_layout Plain Layout

  y     = dgamma(theta-7, 10, 1/2))
\end_layout

\begin_layout Plain Layout

temp <- filter(temp, (theta >= 0)&(theta <= 60))
\end_layout

\begin_layout Plain Layout

p2 <- ggplot(temp, aes(x=theta, y=y)) +
\end_layout

\begin_layout Plain Layout

  geom_line() +
\end_layout

\begin_layout Plain Layout

  geom_vline(xintercept=26, color='blue') +
\end_layout

\begin_layout Plain Layout

  geom_text(data=data.frame(x=28, y=.01, label='hat(theta)'),
\end_layout

\begin_layout Plain Layout

            aes(x=x, y=y, label=label),
\end_layout

\begin_layout Plain Layout

            parse=TRUE, color='blue') +
\end_layout

\begin_layout Plain Layout

  labs(title=expression(paste('Sampling Distribution of ',hat(theta),'*')),
\end_layout

\begin_layout Plain Layout

       x=NULL, y='density') +
\end_layout

\begin_layout Plain Layout

  theme_bw()
\end_layout

\begin_layout Plain Layout

@
\end_layout

\end_inset


\end_layout

\end_inset


\begin_inset Newline newline
\end_inset


\begin_inset Newline newline
\end_inset


\begin_inset Box Frameless
position "t"
hor_pos "c"
has_inner_box 1
inner_pos "t"
use_parbox 0
use_makebox 0
width "100col%"
special "none"
height "1in"
height_special "totalheight"
status open

\begin_layout Plain Layout
\begin_inset ERT
status open

\begin_layout Plain Layout

<<echo=FALSE, fig.width=7, fig.height=5, message=FALSE>>=
\end_layout

\begin_layout Plain Layout

multiplot(p1, p2, cols=1)
\end_layout

\begin_layout Plain Layout

@
\end_layout

\end_inset


\end_layout

\end_inset


\begin_inset Newline newline
\end_inset


\end_layout

\begin_layout Standard
We will outline several methods for producing confidence intervals (in the
 order of most assumptions to fewest).
\end_layout

\begin_layout Subsection
Normal intervals
\end_layout

\begin_layout Standard
This confidence interval assumes the sampling distribution of 
\begin_inset Formula $\hat{\theta}$
\end_inset

 is approximately normal (which is often true due to the central limit theorem).
 We can use the bootstrap replicate samples to get an estimate of the standard
 error of the statistic of interest by just calculating the sample standard
 deviation of the replicated statistics.
\end_layout

\begin_layout Standard
Let 
\begin_inset Formula $\theta()$
\end_inset

 be the statistic of interest and 
\begin_inset Formula $\hat{\theta}$
\end_inset

 be the value of that statistic calculated from the observed data.
 Define 
\begin_inset Formula $\hat{SE}^{*}$
\end_inset

 as the sample standard deviation of the 
\begin_inset Formula $\hat{\theta}^{*}$
\end_inset

 values.
 
\end_layout

\begin_layout Standard
Our first guess as to a confidence interval is 
\begin_inset Formula 
\[
\hat{\theta}\pm z_{1-\alpha/2}\hat{SE}^{*}
\]

\end_inset

 which we could write as 
\begin_inset Formula 
\begin{equation}
\left[\hat{\theta}-z_{1-\alpha/2}\hat{SE}^{*},\;\;\;\hat{\theta}+z_{1-\alpha/2}\hat{SE}^{*}\right]\label{eq:Normal}
\end{equation}

\end_inset


\end_layout

\begin_layout Subsection
Percentile intervals
\end_layout

\begin_layout Standard
The percentile interval doesn't assume normality but it does assume that
 the bootstrap distribution is symmetric and unbiased for the population
 value.
 This is the method we used to calculate confidences intervals in the first
 several chapters.
 It is perhaps the easiest to calculate and understand.
 This method only uses 
\begin_inset Formula $\hat{\theta}^{*}$
\end_inset

, and is
\begin_inset Formula 
\[
\left[\hat{\theta}_{\alpha/2}^{*}\;,\;\;\hat{\theta}_{1-\alpha/2}^{*}\right]
\]

\end_inset


\end_layout

\begin_layout Subsection
Basic intervals
\end_layout

\begin_layout Standard
Unlike the percentile bootstrap interval, the basic interval does not assume
 the bootstrap distribution is symmetric but does assume that 
\begin_inset Formula $\hat{\theta}$
\end_inset

 is an unbiased estimate for 
\begin_inset Formula $\theta$
\end_inset

.
\end_layout

\begin_layout Standard
To address this, we will using the observed distribution of our replicates
 
\begin_inset Formula $\hat{\theta}^{*}$
\end_inset

.
 Let 
\begin_inset Formula $\hat{\theta}_{\alpha/2}^{*}$
\end_inset

 and 
\begin_inset Formula $\hat{\theta}_{1-\alpha/2}^{*}$
\end_inset

 be the 
\begin_inset Formula $\alpha/2$
\end_inset

 and 
\begin_inset Formula $1-\alpha/2$
\end_inset

 quantiles of the replicates 
\begin_inset Formula $\hat{\theta}^{*}$
\end_inset

.
 Then another way to form a confidence interval would be 
\begin_inset Formula 
\[
\left[\hat{\theta}-\left(\hat{\theta}_{1-\alpha/2}^{*}-\hat{\theta}\right),\;\;\;\;\hat{\theta}-\left(\hat{\theta}_{\alpha/2}^{*}-\hat{\theta}\right)\right]
\]

\end_inset

where the minus sign on the upper limit is because 
\begin_inset Formula $\left(\hat{\theta}_{\alpha/2}^{*}-\hat{\theta}\right)$
\end_inset

 is already negative.
 The idea behind this interval is that the sampling variability of 
\begin_inset Formula $\hat{\theta}$
\end_inset

 from 
\begin_inset Formula $\theta$
\end_inset

 is the same as the sampling variability of the replicates 
\begin_inset Formula $\hat{\theta}^{*}$
\end_inset

 from 
\begin_inset Formula $\hat{\theta}$
\end_inset

, and that the distribution of 
\begin_inset Formula $\hat{\theta}$
\end_inset

 is possibly skewed, so we can't add/subtract the same amounts.
 Suppose we observe the distribution of 
\begin_inset Formula $\hat{\theta}^{*}$
\end_inset

 as
\end_layout

\begin_layout Standard
\begin_inset Box Frameless
position "t"
hor_pos "c"
has_inner_box 1
inner_pos "t"
use_parbox 0
use_makebox 0
width "100col%"
special "none"
height "1in"
height_special "totalheight"
status open

\begin_layout Plain Layout
\begin_inset Flex Chunk
status open

\begin_layout Plain Layout

\begin_inset Argument 1
status open

\begin_layout Plain Layout
echo=FALSE, fig.height=3, fig.width=5
\end_layout

\end_inset


\end_layout

\begin_layout Plain Layout

thetas <- seq(0, 10, length=1000)
\end_layout

\begin_layout Plain Layout

plot(thetas, dchisq(thetas, df=3), type='l',
\end_layout

\begin_layout Plain Layout

  axes=FALSE, xlab='', ylab='',
\end_layout

\begin_layout Plain Layout

  main=expression(paste('Distribution of ', hat(theta),'*')))
\end_layout

\begin_layout Plain Layout

axis(side=1, at=c(.5, 2, 8),
\end_layout

\begin_layout Plain Layout

  label=c(expression(paste(hat(theta)[.025],'*')),
\end_layout

\begin_layout Plain Layout

          expression(hat(theta)),
\end_layout

\begin_layout Plain Layout

          expression(paste(hat(theta)[.975],'*'))))
\end_layout

\begin_layout Plain Layout

box()
\end_layout

\end_inset


\end_layout

\end_inset


\end_layout

\begin_layout Standard
Then any particular value of 
\begin_inset Formula $\hat{\theta}^{*}$
\end_inset

 could be 
\emph on
much
\emph default
 larger than 
\begin_inset Formula $\hat{\theta}$
\end_inset

.
 Therefore 
\begin_inset Formula $\hat{\theta}$
\end_inset

 could be 
\emph on
much
\emph default
 larger than 
\begin_inset Formula $\theta$
\end_inset

.
 Therefore our confidence interval should be 
\begin_inset Formula $\left[\hat{\theta}-\textrm{big},\;\hat{\theta}+\textrm{small}\right]$
\end_inset

.
 
\end_layout

\begin_layout Standard
This formula can be simplified to 
\begin_inset Formula 
\begin{eqnarray*}
 & \left[\hat{\theta}-\left(\hat{\theta}_{1-\alpha/2}^{*}-\hat{\theta}\right)\;,\,\hat{\theta}+\left(\hat{\theta}-\hat{\theta}_{\alpha/2}^{*}\right)\right]\\
 & \left[2\hat{\theta}-\hat{\theta}_{1-\alpha/2}^{*}\;,\;\;2\hat{\theta}-\hat{\theta}_{\alpha/2}^{*}\right]
\end{eqnarray*}

\end_inset


\end_layout

\begin_layout Subsection
Towards bias-corrected and accelerated intervals (BCa)
\end_layout

\begin_layout Standard
Different schemes for creating confidence intervals can get quite complicated.
 There is a thriving research community investigating different ways of
 creating intervals and which are better in what instances.
 The BCa interval is the most general of the bootstrap intervals and makes
 the fewest assumptions.
 Unfortunately is can sometimes fail to converge.
 The details of this method are too complicated to be presented here but
 can be found in texts such as chapter 12 in Efron and Tibshiraniâ€™s book
 
\emph on
An Introduction to the Bootstrap
\emph default
 (1998).
\end_layout

\begin_layout Section
Using 
\family typewriter
car::Boot()
\family default
 function
\end_layout

\begin_layout Standard
For every model we've examined we can create simulated data sets using either
 case or residual resampling and produce confidence intervals for any of
 the parameters of interest.
 We won't bother to do this by hand, but rather let R do the work for us.
 The package that contains most of the primary programs for bootstrapping
 is the package 
\family typewriter
boot
\family default
.
 The functions within this package are quite flexible but they are a little
 complex.
 While we will use this package directly later, for now we will use the
 package 
\family typewriter
car
\family default
 which has a very convenient function 
\family typewriter
Boot()
\family default
.
 
\end_layout

\begin_layout Standard
We return to our ANOVA example of hostility scores after three different
 treatment methods.
\begin_inset Newline newline
\end_inset

 
\begin_inset Box Frameless
position "t"
hor_pos "c"
has_inner_box 1
inner_pos "t"
use_parbox 0
use_makebox 0
width "100col%"
special "none"
height "1in"
height_special "totalheight"
status open

\begin_layout Plain Layout
\begin_inset ERT
status open

\begin_layout Plain Layout

<<>>=
\end_layout

\begin_layout Plain Layout

# define the data
\end_layout

\begin_layout Plain Layout

Hostility <- data.frame(
\end_layout

\begin_layout Plain Layout

  HLT = c(96,79,91,85,83,91,82,87,
\end_layout

\begin_layout Plain Layout

          77,76,74,73,78,71,80,
\end_layout

\begin_layout Plain Layout

          66,73,69,66,77,73,71,70,74),
\end_layout

\begin_layout Plain Layout

  Method = c( rep('M1',8), rep('M2',7), rep('M3',9) ) )
\end_layout

\begin_layout Plain Layout

@
\end_layout

\end_inset


\end_layout

\end_inset


\begin_inset Newline newline
\end_inset

The first thing we will do (as we should do in all data analyses) is to
 graph our data.
 
\begin_inset Newline newline
\end_inset


\begin_inset Box Frameless
position "t"
hor_pos "c"
has_inner_box 1
inner_pos "t"
use_parbox 0
use_makebox 0
width "100col%"
special "none"
height "1in"
height_special "totalheight"
status open

\begin_layout Plain Layout
\begin_inset ERT
status open

\begin_layout Plain Layout

<<fig.height=2.5>>=
\end_layout

\begin_layout Plain Layout

library(ggplot2)
\end_layout

\begin_layout Plain Layout

ggplot(Hostility, aes(x=Method, y=HLT)) +
\end_layout

\begin_layout Plain Layout

  geom_boxplot()
\end_layout

\begin_layout Plain Layout

@
\end_layout

\end_inset


\end_layout

\end_inset


\begin_inset Newline newline
\end_inset

We can fit the cell-means model and examine the summary statistics using
 the following code.
\begin_inset Newline newline
\end_inset


\begin_inset Box Frameless
position "t"
hor_pos "c"
has_inner_box 1
inner_pos "t"
use_parbox 0
use_makebox 0
width "100col%"
special "none"
height "1in"
height_special "totalheight"
status open

\begin_layout Plain Layout
\begin_inset ERT
status open

\begin_layout Plain Layout

<<>>=
\end_layout

\begin_layout Plain Layout

model <- lm( HLT ~ -1 + Method, data=Hostility )
\end_layout

\begin_layout Plain Layout

summary(model)
\end_layout

\begin_layout Plain Layout

@
\end_layout

\end_inset


\end_layout

\end_inset


\begin_inset Newline newline
\end_inset

Confidence intervals using the 
\begin_inset Formula $\epsilon_{ij}\stackrel{iid}{\sim}N\left(0,\sigma\right)$
\end_inset

 assumption are given by
\begin_inset Newline newline
\end_inset


\begin_inset Box Frameless
position "t"
hor_pos "c"
has_inner_box 1
inner_pos "t"
use_parbox 0
use_makebox 0
width "100col%"
special "none"
height "1in"
height_special "totalheight"
status open

\begin_layout Plain Layout
\begin_inset ERT
status open

\begin_layout Plain Layout

<<>>=
\end_layout

\begin_layout Plain Layout

confint(model)
\end_layout

\begin_layout Plain Layout

@
\end_layout

\end_inset


\end_layout

\end_inset


\end_layout

\begin_layout Standard
To utilize the bootstrap confidence intervals, we will load the package
 
\family typewriter
car
\family default
 and use the function 
\family typewriter
Boot
\family default
.
 It defaults to using case resampling, but 
\family typewriter
method='residual'
\family default
 will cause it to use residual resampling.
 We can control the number of bootstrap replicates it using with the 
\family typewriter
R
\family default
 parameter.
\begin_inset Newline newline
\end_inset


\begin_inset Box Frameless
position "t"
hor_pos "c"
has_inner_box 1
inner_pos "t"
use_parbox 0
use_makebox 0
width "100col%"
special "none"
height "1in"
height_special "totalheight"
status open

\begin_layout Plain Layout
\begin_inset ERT
status open

\begin_layout Plain Layout

<<boot_calc_1, cache=TRUE>>=
\end_layout

\begin_layout Plain Layout

library(car)
\end_layout

\begin_layout Plain Layout

boot.model <- Boot(model, method='case',     R=999) # default case resampling
 
\end_layout

\begin_layout Plain Layout

boot.model <- Boot(model, method='residual', R=999) # residual resampling
 
\end_layout

\begin_layout Plain Layout

@
\end_layout

\end_inset


\end_layout

\end_inset


\begin_inset Newline newline
\end_inset

The 
\family typewriter
Boot()
\family default
 function has done all work of doing the resampling and storing values of
 
\begin_inset Formula $\hat{\mu}_{1},\hat{\mu}_{2},$
\end_inset

 and 
\begin_inset Formula $\hat{\mu}_{3}$
\end_inset

 for each bootstrap replicate data set created using case resampling.
 To look at the bootstrap estimate of the sampling distribution of these
 statistics, we use the 
\family typewriter
hist()
\family default
 function.
\begin_inset Foot
status open

\begin_layout Plain Layout
The 
\family typewriter
\size normal
hist()
\family default
 function is actually overloaded and will act differently depending on the
 type of object.
 We will send it an object of class 
\family typewriter
boot
\family default
 and the 
\family typewriter
hist()
\family default
 function looks for a function name 
\family typewriter
hist.boot()
\family default
 and when it finds it, just calls it with the function arguments we passed.
\end_layout

\end_inset


\begin_inset Newline newline
\end_inset


\begin_inset Box Frameless
position "t"
hor_pos "c"
has_inner_box 1
inner_pos "t"
use_parbox 0
use_makebox 0
width "100col%"
special "none"
height "1in"
height_special "totalheight"
status open

\begin_layout Plain Layout
\begin_inset ERT
status open

\begin_layout Plain Layout

<<fig.height=3.0, fig.width=6>>=
\end_layout

\begin_layout Plain Layout

hist(boot.model, layout=c(1,3)) # 1 row, 3 columns of plots
\end_layout

\begin_layout Plain Layout

@
\end_layout

\end_inset


\end_layout

\end_inset


\begin_inset Newline newline
\end_inset

While this plot is aesthetically displeasing (we could do so much better
 using 
\family typewriter
ggplot2
\family default
!) this shows the observed bootstrap histogram of 
\begin_inset Formula $\hat{\mu}_{i}^{*}$
\end_inset

, along with the normal distribution centered at 
\begin_inset Formula $\hat{\mu}_{i}$
\end_inset

 with spread equal to the 
\begin_inset Formula $StdDev\left(\hat{\mu}_{i}^{*}\right)$
\end_inset

.
 In this case, the sampling distribution looks very normal and the bootstrap
 confidence intervals should line up well with the asymptotic intervals.
 The function 
\family typewriter
confint()
\family default
 will report the BCa intervals by default, but you can ask for â€œbcaâ€, â€œnormâ€,
 â€œbasicâ€, â€œpercâ€.
\begin_inset Newline newline
\end_inset


\begin_inset Box Frameless
position "t"
hor_pos "c"
has_inner_box 1
inner_pos "t"
use_parbox 0
use_makebox 0
width "100col%"
special "none"
height "1in"
height_special "totalheight"
status open

\begin_layout Plain Layout
\begin_inset ERT
status open

\begin_layout Plain Layout

<<fig.height=3.0, fig.width=6>>=
\end_layout

\begin_layout Plain Layout

confint(boot.model)
\end_layout

\begin_layout Plain Layout

confint(boot.model, type='perc')
\end_layout

\begin_layout Plain Layout

confint(model)
\end_layout

\begin_layout Plain Layout

@
\end_layout

\end_inset


\end_layout

\end_inset


\end_layout

\begin_layout Standard
In this case we see that the confidence intervals match up very well with
 asymptotic intervals.
\end_layout

\begin_layout Standard
The 
\family typewriter
Boot()
\family default
 function will work for a regression model as well.
 In the following example, the data was generated from 
\begin_inset Formula 
\[
y_{i}=\beta_{0}+\beta_{1}x_{i}+\epsilon_{i}
\]

\end_inset

but the 
\begin_inset Formula $\epsilon_{i}$
\end_inset

 terms have a strong positive skew and are not normally distributed.
\end_layout

\begin_layout Standard
\begin_inset Box Frameless
position "t"
hor_pos "c"
has_inner_box 1
inner_pos "t"
use_parbox 0
use_makebox 0
width "100col%"
special "none"
height "1in"
height_special "totalheight"
status open

\begin_layout Plain Layout
\begin_inset ERT
status open

\begin_layout Plain Layout

<<fig.height=3.0, fig.width=6>>=
\end_layout

\begin_layout Plain Layout

my.data <- data.frame(
\end_layout

\begin_layout Plain Layout

  x = seq(0,10, length=20),
\end_layout

\begin_layout Plain Layout

  y = c( 15.49, 17.42, 15.17, 14.99, 13.96, 
\end_layout

\begin_layout Plain Layout

         14.46, 13.69, 14.30, 13.61, 15.35, 
\end_layout

\begin_layout Plain Layout

         12.94, 13.26, 12.65, 12.33, 12.04, 
\end_layout

\begin_layout Plain Layout

         11.19, 13.76, 10.95, 10.36, 10.63))
\end_layout

\begin_layout Plain Layout

ggplot(my.data, aes(x=x, y=y)) + geom_point()
\end_layout

\begin_layout Plain Layout

@
\end_layout

\end_inset


\end_layout

\end_inset


\begin_inset Newline newline
\end_inset

Fitting a linear model, we see a problem that the residuals don't appear
 to be balanced.
 The large residuals are all positive.
 The Shapiro-Wilks test firmly rejects normality of the residuals.
 
\begin_inset Newline newline
\end_inset


\begin_inset Box Frameless
position "t"
hor_pos "c"
has_inner_box 1
inner_pos "t"
use_parbox 0
use_makebox 0
width "100col%"
special "none"
height "1in"
height_special "totalheight"
status open

\begin_layout Plain Layout
\begin_inset ERT
status open

\begin_layout Plain Layout

<<fig.height=3.0, fig.width=6>>=
\end_layout

\begin_layout Plain Layout

model <- lm( y ~ x, data=my.data)
\end_layout

\begin_layout Plain Layout

plot(model, which=1)
\end_layout

\begin_layout Plain Layout

@
\end_layout

\end_inset


\end_layout

\end_inset


\begin_inset Newline newline
\end_inset


\begin_inset Box Frameless
position "t"
hor_pos "c"
has_inner_box 1
inner_pos "t"
use_parbox 0
use_makebox 0
width "100col%"
special "none"
height "1in"
height_special "totalheight"
status open

\begin_layout Plain Layout
\begin_inset ERT
status open

\begin_layout Plain Layout

<<fig.height=3.0, fig.width=6>>=
\end_layout

\begin_layout Plain Layout

shapiro.test( resid(model) )
\end_layout

\begin_layout Plain Layout

@
\end_layout

\end_inset


\end_layout

\end_inset


\end_layout

\begin_layout Standard
As a result, we don't might not feel comfortable using the asymptotic distributi
on of 
\begin_inset Formula $\hat{\beta}_{0}$
\end_inset

 and 
\begin_inset Formula $\hat{\beta}_{1}$
\end_inset

 for the creation of our confidence intervals.
 The bootstrap procedure can give reasonable good intervals, however.
 
\begin_inset Newline newline
\end_inset


\begin_inset Box Frameless
position "t"
hor_pos "c"
has_inner_box 1
inner_pos "t"
use_parbox 0
use_makebox 0
width "100col%"
special "none"
height "1in"
height_special "totalheight"
status open

\begin_layout Plain Layout
\begin_inset ERT
status open

\begin_layout Plain Layout

<<fig.height=3.0, fig.width=6>>=
\end_layout

\begin_layout Plain Layout

boot.model <- Boot( model )
\end_layout

\begin_layout Plain Layout

hist( boot.model )
\end_layout

\begin_layout Plain Layout

confint( boot.model )
\end_layout

\begin_layout Plain Layout

@
\end_layout

\end_inset


\end_layout

\end_inset


\begin_inset Newline newline
\end_inset

Notice that both of the bootstrap distribution for both 
\family typewriter

\begin_inset Formula $\hat{\beta}_{0}^{*}$
\end_inset


\family default
 and 
\family typewriter

\begin_inset Formula $\hat{\beta}_{1}^{*}$
\end_inset


\family default
 are skewed, and the BCa intervals are likely to be the most appropriate
 intervals to use.
\end_layout

\begin_layout Section
Using the 
\family typewriter
boot
\family default
 package
\end_layout

\begin_layout Standard
The 
\family typewriter
car::Boot()
\family default
 function is very handy, but it lacks flexibility; it assumes that you just
 want to create bootstrap confidence intervals for the model coefficients
\begin_inset Foot
status open

\begin_layout Plain Layout
Actually it is a little more flexible, but we might as well use see the
 how to use the 
\family typewriter
boot
\family default
 package sooner rather than later.
\end_layout

\end_inset

.
 The 
\family typewriter
car::Boot()
\family default
 function is actually a nice simple user interface to the 
\family typewriter
boot
\family default
 package which is more flexible, but requires the user to be more precise
 about what statistic should be stored and how the bootstrap samples should
 be created.
 We will next examine how to use this package.
\end_layout

\begin_layout Subsection*
Case resampling 
\end_layout

\begin_layout Standard
Suppose that we have 
\family typewriter
n
\family default
 observations in our sample data.
 Given some vector of numbers resampled from 
\family typewriter
1:n
\family default
, we need to either resample those cases or those residuals and then using
 the new dataset calculate some statistic.
 The function 
\family typewriter
boot()
\family default
 will require the user to write a function that does this.
\begin_inset Newline newline
\end_inset


\begin_inset Newline newline
\end_inset


\begin_inset Box Frameless
position "t"
hor_pos "c"
has_inner_box 1
inner_pos "t"
use_parbox 0
use_makebox 0
width "100col%"
special "none"
height "1in"
height_special "totalheight"
status open

\begin_layout Plain Layout
\begin_inset ERT
status open

\begin_layout Plain Layout

<<>>=
\end_layout

\begin_layout Plain Layout

my.data <- data.frame(
\end_layout

\begin_layout Plain Layout

  x = seq(0,10, length=20),
\end_layout

\begin_layout Plain Layout

  y = c( 15.49, 17.42, 15.17, 14.99, 13.96, 
\end_layout

\begin_layout Plain Layout

         14.46, 13.69, 14.30, 13.61, 15.35, 
\end_layout

\begin_layout Plain Layout

         12.94, 13.26, 12.65, 12.33, 12.04, 
\end_layout

\begin_layout Plain Layout

         11.19, 13.76, 10.95, 10.36, 10.63))
\end_layout

\begin_layout Plain Layout

model <- lm( y ~ x, data=my.data )
\end_layout

\begin_layout Plain Layout

\end_layout

\begin_layout Plain Layout

# Do case resampling with the regression example
\end_layout

\begin_layout Plain Layout

# sample.data is the original data frame 
\end_layout

\begin_layout Plain Layout

# indices - This is a vector of numbers from 1:n which tells
\end_layout

\begin_layout Plain Layout

#           us which cases to use.
  It might be 1,3,3,6,7,7,...
\end_layout

\begin_layout Plain Layout

my.stat <- function(sample.data, indices){
\end_layout

\begin_layout Plain Layout

  data.star <- sample.data[indices, ]      
\end_layout

\begin_layout Plain Layout

  model.star <- lm(y ~ x, data=data.star)
\end_layout

\begin_layout Plain Layout

  output <- coef(model.star)
\end_layout

\begin_layout Plain Layout

  return(output)
\end_layout

\begin_layout Plain Layout

}
\end_layout

\begin_layout Plain Layout

\end_layout

\begin_layout Plain Layout

# original group means
\end_layout

\begin_layout Plain Layout

my.stat(my.data, 1:20)
\end_layout

\begin_layout Plain Layout

# one bootstrap replicate 
\end_layout

\begin_layout Plain Layout

my.stat(my.data, resample(1:20))
\end_layout

\begin_layout Plain Layout

@
\end_layout

\end_inset


\end_layout

\end_inset


\begin_inset Newline newline
\end_inset

Notice that the function we write doesn't need to determine the random sample
 of the indices to use.
 Our function will be told what indices to use (possibly to calculate the
 statistic of interest 
\begin_inset Formula $\hat{\theta}$
\end_inset

, or perhaps a bootstrap replicate 
\begin_inset Formula $\hat{\theta}^{*}$
\end_inset

.
 For example, the BCa method needs to know the original sample estimates
 
\begin_inset Formula $\hat{\theta}$
\end_inset

 to calculate how far the mean 
\begin_inset Formula $\hat{\theta}^{*}$
\end_inset

 value is from 
\begin_inset Formula $\hat{\theta}$
\end_inset

.
 The studentized method calculates a bootstrap estimate of variance for
 each 
\begin_inset Formula $\hat{\theta}^{*}$
\end_inset

 and so bootstraps the bootstrap.
 To avoid the user having to see all of that, we just need to take the set
 of indices given and calculate the statistic of interest.
 
\begin_inset Newline newline
\end_inset


\begin_inset Box Frameless
position "t"
hor_pos "c"
has_inner_box 1
inner_pos "t"
use_parbox 0
use_makebox 0
width "100col%"
special "none"
height "1in"
height_special "totalheight"
status open

\begin_layout Plain Layout
\begin_inset ERT
status open

\begin_layout Plain Layout

<<cache=TRUE>>=
\end_layout

\begin_layout Plain Layout

boot.model <- boot(my.data, my.stat, R=10000)
\end_layout

\begin_layout Plain Layout

boot.ci(boot.model, type='bca', index=1) # CI for Intercept
\end_layout

\begin_layout Plain Layout

@
\end_layout

\end_inset


\end_layout

\end_inset


\begin_inset Newline newline
\end_inset


\begin_inset Box Frameless
position "t"
hor_pos "c"
has_inner_box 1
inner_pos "t"
use_parbox 0
use_makebox 0
width "100col%"
special "none"
height "1in"
height_special "totalheight"
status open

\begin_layout Plain Layout
\begin_inset ERT
status open

\begin_layout Plain Layout

<<>>=
\end_layout

\begin_layout Plain Layout

boot.ci(boot.model, type='bca', index=2) # CI for the Slope
\end_layout

\begin_layout Plain Layout

@
\end_layout

\end_inset


\end_layout

\end_inset


\end_layout

\begin_layout Subsection*
Residual Resampling
\end_layout

\begin_layout Standard
We will now consider the ANOVA problem and in this case we will resample
 the residuals.
\begin_inset Newline newline
\end_inset


\begin_inset Box Frameless
position "t"
hor_pos "c"
has_inner_box 1
inner_pos "t"
use_parbox 0
use_makebox 0
width "100col%"
special "none"
height "1in"
height_special "totalheight"
status open

\begin_layout Plain Layout
\begin_inset ERT
status open

\begin_layout Plain Layout

<<cache=TRUE>>=
\end_layout

\begin_layout Plain Layout

library(boot)
\end_layout

\begin_layout Plain Layout

\end_layout

\begin_layout Plain Layout

# Fit the ANOVA model to the Hostility Data
\end_layout

\begin_layout Plain Layout

model <- lm( HLT ~ Method, data=Hostility )
\end_layout

\begin_layout Plain Layout

\end_layout

\begin_layout Plain Layout

# now include the predicted values and residuals to the data frame
\end_layout

\begin_layout Plain Layout

Hostility <- Hostility %>% mutate(
\end_layout

\begin_layout Plain Layout

  fitted = fitted(model),
\end_layout

\begin_layout Plain Layout

  resid  = resid(model))
\end_layout

\begin_layout Plain Layout

\end_layout

\begin_layout Plain Layout

# Do residual resampling with the regression example
\end_layout

\begin_layout Plain Layout

my.stat <- function(sample.data, indices){
\end_layout

\begin_layout Plain Layout

  data.star <- sample.data %>% mutate(HLT = fitted + resid[indices])
\end_layout

\begin_layout Plain Layout

  model.star <- lm(HLT ~ Method, data=data.star)
\end_layout

\begin_layout Plain Layout

  output <- coef(model.star)
\end_layout

\begin_layout Plain Layout

  return(output)
\end_layout

\begin_layout Plain Layout

}
\end_layout

\begin_layout Plain Layout

\end_layout

\begin_layout Plain Layout

boot.model <- boot(Hostility, my.stat, R=1000)
\end_layout

\begin_layout Plain Layout

@
\end_layout

\end_inset


\end_layout

\end_inset


\begin_inset Newline newline
\end_inset


\begin_inset Newline newline
\end_inset


\begin_inset Box Frameless
position "t"
hor_pos "c"
has_inner_box 1
inner_pos "t"
use_parbox 0
use_makebox 0
width "100col%"
special "none"
height "1in"
height_special "totalheight"
status open

\begin_layout Plain Layout
\begin_inset ERT
status open

\begin_layout Plain Layout

<<>>=
\end_layout

\begin_layout Plain Layout

boot.ci(boot.model, type='bca', index=1) # Mean of Method 1
\end_layout

\begin_layout Plain Layout

@
\end_layout

\end_inset


\end_layout

\end_inset


\begin_inset Newline newline
\end_inset


\begin_inset Box Frameless
position "t"
hor_pos "c"
has_inner_box 1
inner_pos "t"
use_parbox 0
use_makebox 0
width "100col%"
special "none"
height "1in"
height_special "totalheight"
status open

\begin_layout Plain Layout
\begin_inset ERT
status open

\begin_layout Plain Layout

<<>>=
\end_layout

\begin_layout Plain Layout

boot.ci(boot.model, type='bca', index=2) # Mean of Method 2
\end_layout

\begin_layout Plain Layout

@
\end_layout

\end_inset


\end_layout

\end_inset


\begin_inset Newline newline
\end_inset


\begin_inset Box Frameless
position "t"
hor_pos "c"
has_inner_box 1
inner_pos "t"
use_parbox 0
use_makebox 0
width "100col%"
special "none"
height "1in"
height_special "totalheight"
status open

\begin_layout Plain Layout
\begin_inset ERT
status open

\begin_layout Plain Layout

<<>>=
\end_layout

\begin_layout Plain Layout

boot.ci(boot.model, type='bca', index=3) # Mean of Method 3
\end_layout

\begin_layout Plain Layout

@
\end_layout

\end_inset


\end_layout

\end_inset


\begin_inset Newline newline
\end_inset


\begin_inset Newline newline
\end_inset

Notice that we don't need to have the model coefficients 
\begin_inset Formula $\hat{\mu}_{i}$
\end_inset

 be our statistic of interest, we could just as easily produce a confidence
 interval for the residual standard error 
\begin_inset Formula $\hat{\sigma}$
\end_inset

.
\begin_inset Newline newline
\end_inset


\begin_inset Box Frameless
position "t"
hor_pos "c"
has_inner_box 1
inner_pos "t"
use_parbox 0
use_makebox 0
width "100col%"
special "none"
height "1in"
height_special "totalheight"
status open

\begin_layout Plain Layout
\begin_inset ERT
status open

\begin_layout Plain Layout

<<cache=TRUE>>=
\end_layout

\begin_layout Plain Layout

# Do residual resampling with the regression example
\end_layout

\begin_layout Plain Layout

model <- lm( y ~ x, data=my.data )
\end_layout

\begin_layout Plain Layout

my.data <- my.data %>% mutate(
\end_layout

\begin_layout Plain Layout

  fitted = fitted(model),
\end_layout

\begin_layout Plain Layout

  resid  = resid(model))
\end_layout

\begin_layout Plain Layout

\end_layout

\begin_layout Plain Layout

# Define the statisitc I care about
\end_layout

\begin_layout Plain Layout

my.stat <- function(sample.data, indices){
\end_layout

\begin_layout Plain Layout

  data.star <- sample.data %>% mutate(y = fitted + resid[indices])
\end_layout

\begin_layout Plain Layout

  model.star <- lm(y ~ x, data=data.star)
\end_layout

\begin_layout Plain Layout

  output <- summary(model.star)$sigma
\end_layout

\begin_layout Plain Layout

  return(output)
\end_layout

\begin_layout Plain Layout

}
\end_layout

\begin_layout Plain Layout

\end_layout

\begin_layout Plain Layout

boot.model <- boot(my.data, my.stat, R=10000)
\end_layout

\begin_layout Plain Layout

@
\end_layout

\end_inset


\end_layout

\end_inset


\begin_inset Newline newline
\end_inset


\begin_inset Box Frameless
position "t"
hor_pos "c"
has_inner_box 1
inner_pos "t"
use_parbox 0
use_makebox 0
width "100col%"
special "none"
height "1in"
height_special "totalheight"
status open

\begin_layout Plain Layout
\begin_inset ERT
status open

\begin_layout Plain Layout

<<cache=TRUE, fig.height=3.5>>=
\end_layout

\begin_layout Plain Layout

hist(boot.model)
\end_layout

\begin_layout Plain Layout

boot.ci(boot.model, type='bca')
\end_layout

\begin_layout Plain Layout

@
\end_layout

\end_inset


\end_layout

\end_inset


\end_layout

\begin_layout Subsection*
Including Blocking/Stratifying Variables
\end_layout

\begin_layout Standard
When we introduced the ANOVA model we assumed that the groups had equal
 variance but we don't have to.
 If we consider the model with unequal variances among groups
\begin_inset Formula 
\[
Y_{ij}=\mu_{i}+\epsilon_{ij}\;\;\;\;\textrm{where}\;\;\;E\left(\epsilon_{ij}\right)=0\;\;Var\left(\epsilon_{ij}\right)=\sigma_{i}^{2}
\]

\end_inset

 then our usual analysis is inappropriate but we could easily bootstrap
 our confidence intervals for 
\begin_inset Formula $\mu_{i}$
\end_inset

.
 If we do case resampling, this isn't an issue because each included observation
 is an 
\begin_inset Formula $\left(group,\ response\right)$
\end_inset

 pair and our groups will have large or small variances similar to the observed
 data.
 However if we do residual resampling, then we must continue to have this.
 We do this by only resampling residuals within the same group.
 One way to think of this is if your model has a subscript on the variance
 term, then your bootstrap samples must respect that.
\end_layout

\begin_layout Standard
If you want to perform the bootstrap by hand using 
\family typewriter
dplyr
\family default
 commands, it can be done by using the 
\family typewriter
group_by()
\family default
 with whatever the blocking/Stratifying variable is prior to the 
\family typewriter
mosaic::resample()
\family default
 command.
 You could also use the optional 
\family typewriter
group 
\family default
argument to the 
\family typewriter
mosaic::resample()
\family default
 command.
 
\end_layout

\begin_layout Standard
\begin_inset Box Frameless
position "t"
hor_pos "c"
has_inner_box 1
inner_pos "t"
use_parbox 0
use_makebox 0
width "100col%"
special "none"
height "1in"
height_special "totalheight"
status open

\begin_layout Plain Layout
\begin_inset ERT
status open

\begin_layout Plain Layout

<<>>=
\end_layout

\begin_layout Plain Layout

data <- data.frame(y  =c(9.8,9.9,10.1,10.2,   18,19,21,22),
\end_layout

\begin_layout Plain Layout

                   grp=c('A','A','A','A',    'B','B','B','B'),
\end_layout

\begin_layout Plain Layout

                   fit=c( 10,10,10,10,        20,20,20,20   ),
\end_layout

\begin_layout Plain Layout

                   resid=c(-.2,-.1,.1,.2,     -2,-1,1,2   )) 
\end_layout

\begin_layout Plain Layout

data.star <- data %>% group_by(grp) %>%
\end_layout

\begin_layout Plain Layout

  mutate(resid.star = resample(resid),
\end_layout

\begin_layout Plain Layout

         y.star     = fit + resid.star)
\end_layout

\begin_layout Plain Layout

data.star
\end_layout

\begin_layout Plain Layout

@
\end_layout

\end_inset


\end_layout

\end_inset


\begin_inset Newline newline
\end_inset


\begin_inset Box Frameless
position "t"
hor_pos "c"
has_inner_box 1
inner_pos "t"
use_parbox 0
use_makebox 0
width "100col%"
special "none"
height "1in"
height_special "totalheight"
status open

\begin_layout Plain Layout
\begin_inset ERT
status open

\begin_layout Plain Layout

<<>>=
\end_layout

\begin_layout Plain Layout

data <- data.frame(y  =c(9.8,9.9,10.1,10.2,   18,19,21,22),
\end_layout

\begin_layout Plain Layout

                   grp=c('A','A','A','A',    'B','B','B','B'),
\end_layout

\begin_layout Plain Layout

                   fit=c( 10,10,10,10,        20,20,20,20   ),
\end_layout

\begin_layout Plain Layout

                   resid=c(-.2,-.1,.1,.2,     -2,-1,1,2   )) 
\end_layout

\begin_layout Plain Layout

data.star <- data %>% 
\end_layout

\begin_layout Plain Layout

  mutate(resid.star = resample(resid, group=grp),
\end_layout

\begin_layout Plain Layout

         y.star     = fit + resid.star)
\end_layout

\begin_layout Plain Layout

data.star
\end_layout

\begin_layout Plain Layout

@
\end_layout

\end_inset


\end_layout

\end_inset


\end_layout

\begin_layout Standard
Unfortunately the 
\family typewriter
car::Boot()
\family default
 command doesn't take a strata option, but the the 
\family typewriter
boot::boot()
\family default
 command.
\end_layout

\begin_layout Standard
\begin_inset Box Frameless
position "t"
hor_pos "c"
has_inner_box 1
inner_pos "t"
use_parbox 0
use_makebox 0
width "100col%"
special "none"
height "1in"
height_special "totalheight"
status open

\begin_layout Plain Layout
\begin_inset ERT
status open

\begin_layout Plain Layout

<<cache=TRUE>>=
\end_layout

\begin_layout Plain Layout

library(boot)
\end_layout

\begin_layout Plain Layout

\end_layout

\begin_layout Plain Layout

# Fit the ANOVA model to the Hostility Data
\end_layout

\begin_layout Plain Layout

model <- lm( HLT ~ Method, data=Hostility )
\end_layout

\begin_layout Plain Layout

\end_layout

\begin_layout Plain Layout

# now include the predicted values and residuals to the data frame
\end_layout

\begin_layout Plain Layout

Hostility <- Hostility %>% mutate(
\end_layout

\begin_layout Plain Layout

  fitted = fitted(model),
\end_layout

\begin_layout Plain Layout

  resid  = resid(model))
\end_layout

\begin_layout Plain Layout

\end_layout

\begin_layout Plain Layout

# Do residual resampling with the regression example
\end_layout

\begin_layout Plain Layout

my.stat <- function(sample.data, indices){
\end_layout

\begin_layout Plain Layout

  data.star <- sample.data %>% mutate(HLT = fitted + resid[indices])
\end_layout

\begin_layout Plain Layout

  model.star <- lm(HLT ~ Method, data=data.star)
\end_layout

\begin_layout Plain Layout

  output <- coef(model.star)
\end_layout

\begin_layout Plain Layout

  return(output)
\end_layout

\begin_layout Plain Layout

}
\end_layout

\begin_layout Plain Layout

\end_layout

\begin_layout Plain Layout

# strata is a vector of the categorical variable we block/stratify on
\end_layout

\begin_layout Plain Layout

boot.model <- boot( Hostility, my.stat, R=1000, strata=Hostility$Method )
\end_layout

\begin_layout Plain Layout

@
\end_layout

\end_inset


\end_layout

\end_inset


\end_layout

\begin_layout Section
Exercises
\end_layout

\begin_layout Enumerate
We will perform a regression analysis on the following data and use different
 bootstrap resampling methods to create a confidence interval for the slope
 parameter.
 In this case the residuals are symmetric, though perhaps we don't want
 to assume normality.
 
\begin_inset Newline newline
\end_inset


\begin_inset Box Frameless
position "t"
hor_pos "c"
has_inner_box 1
inner_pos "t"
use_parbox 0
use_makebox 0
width "100col%"
special "none"
height "1in"
height_special "totalheight"
status open

\begin_layout Plain Layout
\align center
\begin_inset Tabular
<lyxtabular version="3" rows="4" columns="7">
<features rotate="0" tabularvalignment="middle">
<column alignment="center" valignment="top">
<column alignment="center" valignment="top">
<column alignment="center" valignment="top">
<column alignment="center" valignment="top">
<column alignment="center" valignment="top">
<column alignment="center" valignment="top">
<column alignment="center" valignment="top">
<row>
<cell alignment="center" valignment="top" topline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset Formula $x_{i}$
\end_inset


\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
3
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
4
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
5
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
6
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
7
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
8
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset Formula $y_{i}$
\end_inset


\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
5
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
9
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
10
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
12
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
15
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
15
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" topline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset Formula $\hat{y}_{i}$
\end_inset


\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
6
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
8
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
10
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
12
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
14
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
16
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset Formula $\hat{\epsilon}_{i}$
\end_inset


\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
-1
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
1
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
0
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
0
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
1
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
-1
\end_layout

\end_inset
</cell>
</row>
</lyxtabular>

\end_inset


\end_layout

\end_inset


\end_layout

\begin_deeper
\begin_layout Enumerate
We will first use case resampling.
\end_layout

\begin_deeper
\begin_layout Enumerate
Suppose that the bootstrap indices is selected to be cases 1,3,3,4,6,6.
 Create a new dataset with those cases and calculate the regression coefficients
 
\begin_inset Formula $\hat{\beta}_{0}^{*}$
\end_inset

 and 
\begin_inset Formula $\hat{\beta}_{1}^{*}$
\end_inset

 using R's 
\family typewriter
lm()
\family default
 function.
 Notice that the residual 
\begin_inset Formula $\hat{\epsilon}_{i}$
\end_inset

 is always paired with its value of 
\begin_inset Formula $x_{i}$
\end_inset

 and that in case resampling we don't get the same x-values as our data.
\end_layout

\begin_layout Enumerate
Using the 
\family typewriter
mosaic::resample()
\family default
 command, calculate several values of 
\begin_inset Formula $\hat{\beta}_{1}^{*}$
\end_inset

 using case resampling.
\end_layout

\begin_layout Enumerate
Use the 
\family typewriter
car::Boot()
\family default
 function to calculate the BCa confidence interval for 
\begin_inset Formula $\hat{\beta}_{1}$
\end_inset

 with case resampling
\end_layout

\end_deeper
\begin_layout Enumerate
Next we will use Residual Resampling 
\end_layout

\begin_deeper
\begin_layout Enumerate
Suppose that the bootstrap indices is selected to be cases 1,3,3,4,6,6.
 Create a new dataset with those cases and calculate the regression coefficients
 
\begin_inset Formula $\hat{\beta}_{0}^{*}$
\end_inset

 and 
\begin_inset Formula $\hat{\beta}_{1}^{*}$
\end_inset

 using R's 
\family typewriter
lm()
\family default
 function.
 Notice that the residual 
\begin_inset Formula $\hat{\epsilon}_{i}$
\end_inset

 is not necessarily paired with its value of 
\begin_inset Formula $x_{i}$
\end_inset

 and that the new data set has the same x-values as the original sampled
 data.
\end_layout

\begin_layout Enumerate
Using the resample command, calculate several values of 
\begin_inset Formula $\hat{\beta}_{i}^{*}$
\end_inset

.
 
\emph on
Hint: We can't do this in one simple command, instead we have to make the
 new dataset and then fit the regression.
\end_layout

\begin_layout Enumerate
Use the 
\family typewriter
car::Boot()
\family default
 function to calculate the BCa confidence interval for 
\begin_inset Formula $\hat{\beta}_{1}$
\end_inset

 using residual resampling.
\end_layout

\end_deeper
\end_deeper
\begin_layout Enumerate
The ratio of DDE (related to DDT) to PCB concentrations in bird eggs has
 been shown to have had a number of biological implications.
 The ratio is used as an indication of the movement of contamination through
 the food chain.
 The paper 
\begin_inset Quotes eld
\end_inset

The ratio of DDE to PCB concentrations in Great Lakes herring gull eggs
 and its us in interpreting contaminants data
\begin_inset Quotes erd
\end_inset

 reports the following ratios for eggs collected at sites from the five
 Great Lakes.
 The eggs were collected from both terrestrial and aquatic feeding birds.
 Suppose that we are interested in estimating 
\begin_inset Formula 
\[
\rho=\frac{\mu_{terrestial}}{\mu_{aquatic}}
\]

\end_inset


\begin_inset Newline newline
\end_inset


\begin_inset Box Frameless
position "t"
hor_pos "c"
has_inner_box 1
inner_pos "t"
use_parbox 0
use_makebox 0
width "100col%"
special "none"
height "1in"
height_special "totalheight"
status open

\begin_layout Plain Layout
\align center
\begin_inset Tabular
<lyxtabular version="3" rows="3" columns="12">
<features rotate="0" tabularvalignment="middle">
<column alignment="center" valignment="top">
<column alignment="center" valignment="top">
<column alignment="center" valignment="top">
<column alignment="center" valignment="top">
<column alignment="center" valignment="top">
<column alignment="center" valignment="top">
<column alignment="center" valignment="top">
<column alignment="center" valignment="top">
<column alignment="center" valignment="top">
<column alignment="center" valignment="top">
<column alignment="center" valignment="top">
<column alignment="center" valignment="top">
<row>
<cell alignment="center" valignment="top" topline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\end_layout

\end_inset
</cell>
<cell multicolumn="1" alignment="center" valignment="top" topline="true" bottomline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
DDE to PCB Ratio
\end_layout

\end_inset
</cell>
<cell multicolumn="2" alignment="center" valignment="top" topline="true" bottomline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\end_layout

\end_inset
</cell>
<cell multicolumn="2" alignment="center" valignment="top" topline="true" bottomline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\end_layout

\end_inset
</cell>
<cell multicolumn="2" alignment="center" valignment="top" topline="true" bottomline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\end_layout

\end_inset
</cell>
<cell multicolumn="2" alignment="center" valignment="top" topline="true" bottomline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\end_layout

\end_inset
</cell>
<cell multicolumn="2" alignment="center" valignment="top" topline="true" bottomline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\end_layout

\end_inset
</cell>
<cell multicolumn="2" alignment="center" valignment="top" topline="true" bottomline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\end_layout

\end_inset
</cell>
<cell multicolumn="2" alignment="center" valignment="top" topline="true" bottomline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\end_layout

\end_inset
</cell>
<cell multicolumn="2" alignment="center" valignment="top" topline="true" bottomline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\end_layout

\end_inset
</cell>
<cell multicolumn="2" alignment="center" valignment="top" topline="true" bottomline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\end_layout

\end_inset
</cell>
<cell multicolumn="2" alignment="center" valignment="top" topline="true" bottomline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
Terrestrial
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
76.50
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
6.03
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
3.51
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
9.96
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
4.24
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
7.74
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
9.54
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
41.70
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
1.84
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
2.5
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
1.54
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" bottomline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
Aquatic
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" bottomline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
0.27
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" bottomline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
0.61
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" bottomline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
0.54
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" bottomline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
0.14
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" bottomline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
0.63
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" bottomline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
0.23
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" bottomline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
0.56
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" bottomline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
0.48
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" bottomline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
0.16
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" bottomline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
0.18
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" bottomline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\end_layout

\end_inset
</cell>
</row>
</lyxtabular>

\end_inset


\end_layout

\end_inset


\begin_inset Newline newline
\end_inset


\begin_inset Box Frameless
position "t"
hor_pos "c"
has_inner_box 1
inner_pos "t"
use_parbox 0
use_makebox 0
width "100col%"
special "none"
height "1in"
height_special "totalheight"
status open

\begin_layout Plain Layout
\begin_inset ERT
status open

\begin_layout Plain Layout

<<>>=
\end_layout

\begin_layout Plain Layout

Pollution <- data.frame(
\end_layout

\begin_layout Plain Layout

  value = c(76.50, 6.03, 3.51, 9.96, 4.24, 7.74, 9.54, 41.70, 1.84, 2.5, 1.54,
\end_layout

\begin_layout Plain Layout

             0.27, 0.61, 0.54, 0.14, 0.63, 0.23, 0.56,  0.48, 0.16, 0.18       ),
\end_layout

\begin_layout Plain Layout

  type  = c( rep('Terrestrial',11), rep('Aquatic',10) ) )
\end_layout

\begin_layout Plain Layout

model <- lm( value ~ -1 + type, data=Pollution)
\end_layout

\begin_layout Plain Layout

coef(model)
\end_layout

\begin_layout Plain Layout

@
\end_layout

\end_inset


\end_layout

\end_inset


\end_layout

\begin_deeper
\begin_layout Enumerate
Recall that the ANOVA with the cell mean representation will calculate the
 group means.
 Use the 
\family typewriter
lm()
\family default
 function to calculate the means of the two groups.
 Notice that the p-values and any confidence intervals from this model are
 useless because we are egregiously violating the equal variance and normality
 assumptions on the residuals.
\end_layout

\begin_layout Enumerate
Using R and calculate the ratio 
\begin_inset Formula $\hat{\rho}=\bar{y}_{T}/\bar{y}_{A}$
\end_inset

.
 
\emph on
Hint: what is returned by 
\family typewriter
coef(model)[1]
\family default
?
\end_layout

\begin_layout Enumerate
Use the 
\family typewriter
mosaic::resample()
\family default
 function to generate several bootstrap datasets using case resampling.
 Do you get 11 Terrestrial observations in each dataset? Do this ten or
 twenty times (don't show these computations) and note the most unbalanced
 data set.
\end_layout

\begin_layout Enumerate
Use the 
\family typewriter
mosaic::resample()
\family default
 function to generate several bootstrap datasets using residual resampling?
 Do you get data sets where a simulated aquatic observation has been paired
 with a huge residual term from the terrestrial.
 Does this seem appropriate?
\end_layout

\begin_layout Enumerate
The 
\family typewriter
mosaic::resample()
\family default
 function includes an optional 
\family typewriter
groups
\family default
 argument that does the resampling within a specified group (thus we will
 always get 11 Terrestrial observations and 10 Aquatic).
 Use this to generate several bootstrap datasets.
 In this case, it is unnecessary to specify if we are sampling cases or
 residuals.
 Why?
\end_layout

\begin_layout Enumerate
The 
\family typewriter
car::Boot()
\family default
 function cannot handle the grouping, but 
\family typewriter
boot()
\family default
 can.
 
\end_layout

\begin_deeper
\begin_layout Enumerate
The following function will calculate 
\begin_inset Formula $\hat{\rho}$
\end_inset

, the statistic of interest, given the original data and a set of indices
 to use.
\begin_inset Newline newline
\end_inset


\begin_inset Box Frameless
position "t"
hor_pos "c"
has_inner_box 1
inner_pos "t"
use_parbox 0
use_makebox 0
width "100col%"
special "none"
height "1in"
height_special "totalheight"
status open

\begin_layout Plain Layout
\begin_inset ERT
status open

\begin_layout Plain Layout

<<>>=
\end_layout

\begin_layout Plain Layout

calc_rhohat <- function(data, indices){
\end_layout

\begin_layout Plain Layout

  data.star <- data[indices, ]
\end_layout

\begin_layout Plain Layout

  model.star <- lm( value ~ -1 + type, data=data.star )
\end_layout

\begin_layout Plain Layout

  return( coef(model.star)[2] / coef(model.star)[1] )
\end_layout

\begin_layout Plain Layout

}
\end_layout

\begin_layout Plain Layout

@
\end_layout

\end_inset


\end_layout

\end_inset


\end_layout

\begin_layout Enumerate
Call this function using the 
\family typewriter
Pollution
\family default
 data set and indices 
\family typewriter
1:21
\family default
.
 Notice that this calculates the sample statistic 
\begin_inset Formula $\hat{\rho}$
\end_inset

 that we calculated previously.
\end_layout

\begin_layout Enumerate
Call this function using 
\family typewriter
indices = resample(1:21, groups=Pollution$type)
\family default
.
 Notice that this calculates the sample statistic 
\begin_inset Formula $\hat{\rho}^{*}$
\end_inset

 where we are doing resampling within each group.
\end_layout

\begin_layout Enumerate
Use the 
\family typewriter
boot()
\family default
 function with the option 
\family typewriter
strata=Pollution$type
\family default
 option, which is causes R to do the resampling within each group.
\end_layout

\begin_layout Enumerate
What is the 95% BCa CI for 
\begin_inset Formula $\rho$
\end_inset

? Show the histogram of the bootstrap estimate of the distribution of 
\begin_inset Formula $\hat{\rho}$
\end_inset

.
\end_layout

\end_deeper
\end_deeper
\end_body
\end_document
